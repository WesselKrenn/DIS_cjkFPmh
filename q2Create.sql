CREATE INDEX idx_SRTD ON StudentRegistrationsToDegrees USING hash(StudentId);
CREATE MATERIALIZED VIEW MaxGradesQ1 AS SELECT co.CourseOfferId, MAX(Grade) AS MaxGrade FROM CourseRegistrations cr INNER JOIN CourseOffers co ON (cr.courseofferid = co.courseofferid) WHERE Year = 2018 AND Quartile = 1 GROUP BY co.CourseOfferId;
CREATE MATERIALIZED VIEW PointsPerStudent(StudentId, Studentregistrationid, sumECTS, GPA) as SELECT cr.studentid, cr.studentregistrationid, sum(ects, sum(cr.grade * c.ects)/sum(c.ects) from courseregistrations cr, courseoffers co, courses c where cr.courseofferid = co.courseofferid and co.courseid = c.courseid and cr.grade >= 5 group by cr.studentid, cr.studentregistrationid;
CREATE MATERIALIZED VIEW StudentNoFails(studentregistrationid) as select cr.studentregistrationid from courseregistrations cr except select cr2.studentregistrationid from courseregistrations cr2 where cr2.grade > 5;
CREATE UNIQUE INDEX idx_pointsperstudent on pointsperstudent(studentregistrationid);
